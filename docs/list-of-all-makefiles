--- /home/saidler/slam/tatari-tv/org-metrics/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run py.test

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=org_metrics tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/pyspark-intelligence-jobs/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --durations=10 -n auto --cov=pyspark_intelligence_jobs tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/ingestion-jobs/Makefile ---
.DEFAULT_GOAL: build

.PHONY: build
build:
	tox

.PHONY: unit-test
unit-test:
	tox -e tests

.PHONY: type-check
type-check:
	tox -e mypy

.PHONY: lint
lint:
	tox -e pre-commit

# Distribution targets
.PHONY: sdist
sdist:
	python setup.py sdist

.PHONY: clean
clean:
	rm -rf build/
	rm -rf .tox/
	rm -rf .venv/
	rm -rf dist/
	rm -rf *.egg-info
--- /home/saidler/slam/tatari-tv/python-tatari-service-lib/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_service_lib tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/pyspark-insights-jobs/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --durations=10 -n auto --cov=pyspark_insights_jobs tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete


# Utilities
.PHONY: update-expected
update-expected:
	poetry run python -c 'assert input("Have you verified the correctness of the test results? [y/n] ") == "y"'
	PR_UPDATE_EXPECTED=true poetry run pytest -n0 tests/unit/performance_report/test_performance_report_streaming_etl.py -k 'test_performance_report_streaming_etl_all' -qqq --no-header --no-summary

.PHONY: update-expected-experimental
update-expected-experimental:
	poetry run python -c 'assert input("Have you verified the correctness of the test results? [y/n] ") == "y"'
	PR_UPDATE_EXPECTED=true poetry run pytest -n0 tests/unit/performance_report/test_performance_report_streaming_experimental_etl.py -k 'test_performance_report_streaming_experimental_etl_all' -qqq --no-header --no-summary
--- /home/saidler/slam/tatari-tv/python-tatari-kafka-client/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_kafka_client tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-app-cookiecutter/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: clean dev lint

# Dev
.PHONY: dev
dev:
	poetry install

# Testing related targets
.PHONY: lint
lint:
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .tox/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-app-cookiecutter/{{ cookiecutter.app_name.replace("_", "-") }}/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/ml-impression-level-performance/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files

# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build

.PHONY: github-release
github-release:
	poetry run ./github-release.sh

# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete


.PHONY: mlflow
mlflow:
	.venv/bin/mlflow server --backend-store-uri sqlite:///mlflow.db --default-artifact-root ./mlruns --host 0.0.0.0 --port 5001
--- /home/saidler/slam/tatari-tv/python-tatari-probabilistic-modeling/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_probabilistic_modeling tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/tatari-offline-reporting-api/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/ml-rtg-recommended-spend/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files

# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build

.PHONY: github-release
github-release:
	poetry run ./github-release.sh

# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-media-planning-service-proto/Makefile ---
.DEFAULT_GOAL := proto

.PHONY: all
all: dev unit-test type-check lint sdist release

SRC_DIR:=tatari_media_planning_service_proto
PROTO_DIR:=$(SRC_DIR)/proto
PROTOS := $(wildcard $(PROTO_DIR)/*.proto $(PROTO_DIR)/*/*.proto)
PROTOS_GEN = $(patsubst $(PROTO_DIR)/%.proto, $(PROTO_DIR)/%_pb2_grpc.py, $(PROTOS)) \
	     $(patsubst $(PROTO_DIR)/%.proto, $(PROTO_DIR)/%_pb2.py, $(PROTOS)) \
	     $(patsubst $(PROTO_DIR)/%.proto, $(PROTO_DIR)/%_pb2.pyi, $(PROTOS))

# gRPC targets
.PHONY: proto
proto:
	poetry run python -m grpc_tools.protoc $(SRC_DIR)/proto/*.proto --python_out=. --proto_path=. --grpc_python_out=. --mypy_out=.


# dev targets
.PHONY: dev
dev:
	poetry install

# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_media_planning_service_proto tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist: proto
	make -B proto
	poetry build -f sdist

.PHONY: release
release: proto
	poetry build

# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	rm -f $(PROTOS_GEN)
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/tatari-shopify-app/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files

# Testing related targets
.PHONY: test
test: dev
	env DJANGO_SETTINGS_MODULE=tatari_shopify.settings.test poetry run pytest

.PHONY: unit-test
unit-test: dev
	env DJANGO_SETTINGS_MODULE=tatari_shopify.settings.test poetry run pytest --junitxml=pytest.xml --cov=tatari_shopify tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-event-categorization/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/pyspark-data-science-jobs/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --durations=10 -n auto --cov=pyspark_data_science_jobs tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .tox/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/lowess/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_lowess tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-data-utils/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_data_utils tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/media-planning-service/Makefile ---
GIT_DESCRIBE	:= $(shell git describe --always --abbrev=7)
PYPI_USERNAME	?= $(shell cat ~/.config/pip/pip.conf | grep extra-index-url | awk -F '[//|@]' '{print $$3}' | awk -F '[:]' '{print $$1}')
PYPI_PASSWORD	?= $(shell cat ~/.config/pip/pip.conf | grep extra-index-url | awk -F '[//|@]' '{print $$3}' | awk -F '[:]' '{print $$2}')
.DEFAULT_GOAL 	:= dev

.PHONY: all
all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=media_planning_service tests/unit --log-cli-level=CRITICAL

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration -s

type-check: dev
	poetry run python -m mypy

lint: dev
	poetry run pre-commit run --all-files

run-rest: dev
	poetry run uvicorn media_planning_service.rest.app:app --reload

# Clean
clean: dev-clean
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '*.pyc' -delete
	find . -name '__pycache__' -delete

# --
# -- Dev/local only
# --

LOCAL_DUMP_FILE:=./schema/local-db/media-planning-service-pgdump.tar.gz
LATEST_S3_DUMP_FILE:=$(shell aws s3api list-objects-v2 --bucket "tatari-pg-dumps" --prefix 'media_planning_service' --query 'sort_by(Contents, &LastModified)[-1].Key' --output=text)
DUMP_CHECK:=$(LOCAL_DUMP_FILE)-$(LATEST_S3_DUMP_FILE).check

dev-clean:
	rm -f $(LOCAL_DUMP_FILE)-*.check

get-postgres-dump:
	@echo "LATEST_S3_DUMP_FILE: $(LATEST_S3_DUMP_FILE)"
	@echo "Downloading the latest pgdump from S3.."
	@[ -f "$(DUMP_CHECK)" ] && echo "  dump file already exists" \
		|| aws s3 cp s3://tatari-pg-dumps/$(LATEST_S3_DUMP_FILE) $(LOCAL_DUMP_FILE)
	@touch "$(DUMP_CHECK)"

# -- normal Docker compose build, this is the preferred method for running this service locally

docker-compose-build:
	docker compose up --build -d

docker-compose: get-postgres-dump docker-compose-build

docker-compose-down:
	docker compose -f docker-compose.yaml down

docker-compose-with-farnsworth-build:
	docker compose -f docker-compose.yaml -f docker-compose.farnsworth.yaml up --build -d

docker-compose-with-farnsworth: get-postgres-dump docker-compose-with-farnsworth-build

docker-compose-with-farnsworth-down:
	docker compose -f docker-compose.yaml -f docker-compose.farnsworth.yaml down

docker-compose-clean:
	@echo "Deleting media-planning-service volumes and containers..."
	docker ps -a | grep 'media-planning-service'  | awk -F ' ' '{print $$1}' | xargs -I {} sh -c "docker rm -f {}"
	docker volume list | grep 'media-planning-service' | awk -F ' ' '{print $$2}' | xargs -I {} sh -c "docker volume rm -f {}"

psql:
	docker exec -it media-planning-service-db-1 psql -U tatari media_planning_service
--- /home/saidler/slam/tatari-tv/python-tatari-migrations/Makefile ---
.DEFAULT_GOAL: build

.PHONY: all
all: build unit-test type-check lint sdist

# Build targets
.PHONY: build
build:
	tox


# Testing related targets
.PHONY: unit-test
unit-test:
	tox -e tests

.PHONY: type-check
type-check:
	tox -e mypy

.PHONY: lint
lint:
	pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	python setup.py sdist


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .tox/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/performance-report/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install

run:
	.venv/bin/uvicorn performance_report.app:app --workers 1 --reload

# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=performance_report tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-deltalake/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml -n0 tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build

.PHONY: github-release
github-release:
	poetry run ./github-release.sh


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-spark-bi-tools/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --durations=10 -n auto --cov=pyspark_spark_bi_tools_jobs tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/databricks-prometheus-exporter/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=databricks_prometheus_exporter tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-beeswax-client/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/shopify-app/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev type-check lint test

# Dev
.PHONY: dev
dev:
	yarn install


# Testing related targets
.PHONY: test
test: dev
	yarn test

.PHONY: type-check
type-check: dev
	yarn typecheck

.PHONY: lint
lint: dev
	yarn lint


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ node_modules/ .cache/
--- /home/saidler/slam/tatari-tv/gitops-infra/goldilocks/Makefile ---
# Makefile
CHART_REPO_NAME   := fairwinds-stable
CHART_REPO_URL    := https://charts.fairwinds.com/stable
CHART_NAME        := goldilocks
CHART_VERSION     := 9.0.1
CHART_VALUES_FILE := values.yaml
NAMESPACE         := goldilocks
OVERLAYS          := prod staging test ops apps
.DEFAULT_GOAL     := default

include ../Makefile.in
--- /home/saidler/slam/tatari-tv/gitops-infra/gha-rss-controller/Makefile ---
# Makefile
CHART_REPO_NAME   := arc
CHART_REPO_URL    := oci://ghcr.io/actions/actions-runner-controller-charts/gha-runner-scale-set-controller
CHART_NAME        := gha-runner-scale-set-controller
CHART_VERSION     := 0.8.3
CHART_VALUES_FILE := values.yaml
NAMESPACE         := gha-system
OVERLAYS          := dev staging test prod ops
.DEFAULT_GOAL     := default

include ../Makefile.in
--- /home/saidler/slam/tatari-tv/gitops-infra/istio-ztunnel/Makefile ---
# Makefile
CHART_REPO_NAME   := istio
CHART_REPO_URL    := https://istio-release.storage.googleapis.com/charts
CHART_NAME        := ztunnel
CHART_VERSION     := 1.24.2
CHART_VALUES_FILE := values.yaml
NAMESPACE         := istio-system
OVERLAYS          := prod staging dev test ops apps
.DEFAULT_GOAL     := default

include ../Makefile.in
--- /home/saidler/slam/tatari-tv/gitops-infra/istio-base/Makefile ---
# Makefile
CHART_REPO_NAME   := istio
CHART_REPO_URL    := https://istio-release.storage.googleapis.com/charts
CHART_NAME        := base
CHART_VERSION     := 1.24.2
CHART_VALUES_FILE := values.yaml
NAMESPACE         := istio-system
OVERLAYS          := prod staging dev test ops apps
.DEFAULT_GOAL     := default

include ../Makefile.in
--- /home/saidler/slam/tatari-tv/gitops-infra/loki/Makefile ---
# Makefile
CHART_REPO_NAME   := grafana
CHART_REPO_URL    := https://grafana.github.io/helm-charts
CHART_NAME        := loki
CHART_VERSION     := 5.47.2
CHART_VALUES_FILE := values.yaml
NAMESPACE         := loki-system
OVERLAYS          := prod staging dev test ops apps
.DEFAULT_GOAL     := default

include ../Makefile.in

post-template:
	# Remove configmap.yaml from upstream, overridden in overlays
	@cd ${MANIFEST_DIR}; kustomize edit remove resource ${CHART_NAME}/templates/config.yaml
	@cd ${MANIFEST_DIR}; kustomize edit remove resource ${CHART_NAME}/templates/monitoring/dashboards/configmap-1.yaml
	@cd ${MANIFEST_DIR}; kustomize edit remove resource ${CHART_NAME}/templates/monitoring/dashboards/configmap-2.yaml
	@cp ${MANIFEST_DIR}/${CHART_NAME}/templates/monitoring/dashboards/configmap*.yaml ${BASE_DIR}
	@sed -i 's|---|---\n# yamllint disable rule:line-length|g' ${BASE_DIR}/configmap-*.yaml
	@sed -i 's|cluster=[~]*\\\"$$cluster\\\"[, ]*||g' ${BASE_DIR}/configmap-*.yaml
	@sed -i 's|label_values(loki_build_info{}, namespace|label_values(kube_namespace_created, namespace|g' ${BASE_DIR}/configmap-*.yaml
	@sed -i 's|level=\\\"$$level\\\"|level=~\\\"$$level\\\"|g' ${BASE_DIR}/configmap-*.yaml
	@sed -i 's/job=~\\\"($$namespace)\/(loki|enterprise-logs)-[a-zA-Z]*\\\"[, ]*//g' ${BASE_DIR}/configmap-*.yaml
	@sed -i 's|,{"allValue":null,"current":{"text":"prod","value":"prod"}[][_(),":$$a-zA-Z0-9 ]*"label":"cluster"[][_(),":$$a-zA-Z0-9 ]*}||g' ${BASE_DIR}/configmap-*.yaml
	@sed -i 's|job=~\\\"$$namespace/[-a-zA-Z0-9()\|]*\\\"[, ]*||g' ${BASE_DIR}/configmap-*.yaml
	#@sed -i 's|label_values(kube_namespace_created, namespace)|loki-system|g' ${BASE_DIR}/configmap-*.yaml
	#@sed -i 's|hide":0,\("includeAll":false,"label":"namespace"\)|hide":1,\1|g' ${BASE_DIR}/configmap-*.yaml
	@sed -i 's|{"text":"prod","value":"prod"}|{"text":"loki-system","value":"loki-system"}|g' ${BASE_DIR}/configmap-*.yaml
	@sed -i 's|{namespace=[~]*\\\"$$namespace\\\"}||g' ${BASE_DIR}/configmap-*.yaml
	@sed -i 's|namespace=[~]*\\\"$$namespace\\\"[, ]*||g' ${BASE_DIR}/configmap-*.yaml
	@cd ${BASE_DIR}; kustomize edit add resource configmap-1.yaml
	@cd ${BASE_DIR}; kustomize edit add resource configmap-2.yaml
--- /home/saidler/slam/tatari-tv/gitops-infra/istio-cni/Makefile ---
# Makefile
CHART_REPO_NAME   := istio
CHART_REPO_URL    := https://istio-release.storage.googleapis.com/charts
CHART_NAME        := cni
CHART_VERSION     := 1.24.2
CHART_VALUES_FILE := values.yaml
NAMESPACE         := istio-system
OVERLAYS          := prod staging dev test ops apps
.DEFAULT_GOAL     := default

include ../Makefile.in
--- /home/saidler/slam/tatari-tv/gitops-infra/gha-runners/Makefile ---
# Makefile
CHART_REPO_NAME   := gha-runner-scale-set
CHART_REPO_URL    := oci://ghcr.io/actions/actions-runner-controller-charts/gha-runner-scale-set
CHART_NAME        := gha-runner-scale-set
CHART_VERSION     := 0.8.3
CHART_VALUES_FILE := values.yaml
NAMESPACE         := gha-runners
OVERLAYS          := dev staging test prod ops
.DEFAULT_GOAL     := default

include ../Makefile.in
--- /home/saidler/slam/tatari-tv/gitops-infra/image-swapper/Makefile ---
# Makefile
CHART_REPO_NAME   := estahn
CHART_REPO_URL    := https://estahn.github.io/charts
CHART_NAME        := k8s-image-swapper
CHART_VERSION     := 1.11.0
CHART_VALUES_FILE := values.yaml
NAMESPACE         := tatari-system
OVERLAYS          := prod staging dev test ops apps
.DEFAULT_GOAL     := default

include ../Makefile.in
--- /home/saidler/slam/tatari-tv/gitops-infra/reloader/Makefile ---
# Makefile
CHART_REPO_NAME   := stakater
CHART_REPO_URL    := https://stakater.github.io/stakater-charts
CHART_NAME        := reloader
CHART_VERSION     := 2.1.3
CHART_VALUES_FILE := values.yaml
NAMESPACE         := reloader
OVERLAYS          := prod staging dev test ops apps
.DEFAULT_GOAL     := default

include ../Makefile.in
--- /home/saidler/slam/tatari-tv/gitops-infra/promtail/Makefile ---
# Makefile
CHART_REPO_NAME   := grafana
CHART_REPO_URL    := https://grafana.github.io/helm-charts
CHART_NAME        := promtail
CHART_VERSION     := 6.15.5
CHART_VALUES_FILE := values.yaml
NAMESPACE         := loki-system
OVERLAYS          := prod staging dev test ops apps
.DEFAULT_GOAL     := default

include ../Makefile.in
--- /home/saidler/slam/tatari-tv/gitops-infra/prometheus/Makefile ---
# Makefile
CHART_REPO_NAME   := prometheus
CHART_REPO_URL    := https://prometheus-community.github.io/helm-charts
CHART_NAME        := kube-prometheus-stack
CHART_VERSION     := 51.9.4
CHART_VALUES_FILE := values.yaml
NAMESPACE         := prometheus-system
OVERLAYS          := prod staging dev test ops apps
.DEFAULT_GOAL     := default

include ../Makefile.in
--- /home/saidler/slam/tatari-tv/gitops-infra/httpbin/Makefile ---
# Makefile
CHART_REPO_NAME   := mautheusfm
CHART_REPO_URL    := https://matheusfm.dev/charts
CHART_NAME        := httpbin
CHART_VERSION     := 0.1.1
CHART_VALUES_FILE := values.yaml
NAMESPACE         := httpbin
OVERLAYS          := prod staging dev test ops apps
.DEFAULT_GOAL     := default

include ../Makefile.in

post-template:
	# Remove test-connection
	@cd ${MANIFEST_DIR}; kustomize edit remove resource ${CHART_NAME}/templates/tests/test-connection.yaml
--- /home/saidler/slam/tatari-tv/gitops-infra/istio-istiod/Makefile ---
# Makefile
CHART_REPO_NAME   := istio
CHART_REPO_URL    := https://istio-release.storage.googleapis.com/charts
CHART_NAME        := istiod
CHART_VERSION     := 1.24.2
CHART_VALUES_FILE := values.yaml
NAMESPACE         := istio-system
OVERLAYS          := prod staging dev test ops apps
.DEFAULT_GOAL     := default

include ../Makefile.in
--- /home/saidler/slam/tatari-tv/python-tatari-apm/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_apm tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-features/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_features tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/data-operations/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=data_operations tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/tatari-clickhouse-migrations/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_clickhouse_migrations tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/alertmanager-webhook-logger/Makefile ---
.DEFAULT_GOAL := build

# go source files, ignore vendor directory
SRC = $(shell find . -type f -name '*.go' -not -path "./vendor/*")

VERSION := $(shell git describe --tags --always --dirty)
BUILD := `git rev-parse HEAD`

LDFLAGS=-ldflags "-X=main.Version=$(VERSION) -X=main.Build=$(BUILD)"

.PHONY: all
all: unit-test type-check lint build

.PHONY: build
build:
	mkdir -p dist
	go build -o dist/alertmanager-webhook-logger

.PHONY: run
run: build
	./dist/alertmanager-webhook-logger 2> err.log

# Testing related targets
.PHONY: unit-test
unit-test:
	go test -cover -coverprofile=coverage.txt ./...

.PHONY: test
test: unit-test

.PHONY: coverage
coverage: unit-test
	go tool cover -html=coverage.txt

.PHONY: fmt
fmt:
	gofmt -l -w $(SRC)

.PHONY: type-check
type-check:
	go run honnef.co/go/tools/cmd/staticcheck@latest ./...

.PHONY: lint
lint: fmt

# Clean
.PHONY: clean
clean:
	rm -rf dist/
	rm -rf .coverage
--- /home/saidler/slam/tatari-tv/python-tvp-client/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tvp_client tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/pyspark-embedding-factory-jobs/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest --junitxml=pytest.xml --durations=10 -n0 --cov=pyspark_embedding_factory_jobs

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --durations=10 -n0 --cov=pyspark_embedding_factory_jobs tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest --junitxml=pytest.xml --durations=10 -n0 --cov=pyspark_embedding_factory_jobs tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/pyspark-jobs-cookiecutter/pyspark-{{ cookiecutter.app_name.replace("_", "-") }}-jobs/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --durations=10 -n auto --cov=pyspark_{{ cookiecutter.app_name }}_jobs tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/pyspark-jobs-cookiecutter/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: clean dev lint

# Dev
.PHONY: dev
dev:
	poetry install

# Testing related targets
.PHONY: lint
lint:
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .tox/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-model-metrics/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_model_metrics tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/pyspark-calculation-jobs/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --durations=10 -n auto --cov=pyspark_calculation_jobs tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/hiring-homework/solutions/interns_2020/pascal/makefile ---
NAME = "Main"

PATH_TO_FX := ./javafx-sdk-13.0.2

default:
	@echo "Compiling..."
	javac -d out/src --module-path $(PATH_TO_FX)/lib --add-modules javafx.controls src/*.java

run: default
	@echo "Running..."
	java --module-path $(PATH_TO_FX)/lib --add-modules javafx.controls -cp out/src $(NAME)

clean:
	-@rm out/src/*.class
	-@rm out/*.jar
	-@rm *.class
--- /home/saidler/slam/tatari-tv/hiring-homework/solutions/hiring_2019/robert_jakubov/Makefile ---
## Build container
build:
	@bash -x scripts/build.sh

 ## Run container locally
run:
	@bash -x scripts/run.sh--- /home/saidler/slam/tatari-tv/hiring-homework/solutions/hiring_2022/nick_maccarthy/nick-maccarthy-exercise/Makefile ---

build:
	docker build -t tatari-nmac .

run:
	docker run -it tatari-nmac

run-all:
	make build && make run--- /home/saidler/slam/tatari-tv/hiring-homework/solutions/hiring_2021/jason_harley/Makefile ---
.PHONY: up clean test

all: up

up:
	vagrant up

clean:
	vagrant destroy

test:
	vagrant up
	vagrant destroy -f
--- /home/saidler/slam/tatari-tv/hiring-homework/solutions/hiring_2021/matt_behrens/Makefile ---
.PHONY: fetch test

all: fetch test
	echo

fetch:
	wget -O sqlite.tar.gz https://github.com/sqlite/sqlite/archive/refs/tags/version-3.30.0.tar.gz
	tar xvzf sqlite.tar.gz
	mv sqlite-version-3.30.0 sqlite

test:
	mkdir -p ./sqlite/build
	cp main.sh ./sqlite/build/
	cp monitor.sh ./sqlite/build/
	cd ./sqlite/build/ && ./main.sh

clean:
	rm *.gz
	rm -rf sqlite/
--- /home/saidler/slam/tatari-tv/hiring-homework/solutions/hiring_2021/dan_mahoney/Makefile ---
PROJECT         := github.com/dmswe/ttha
GOCMD           := go
GOBUILD         := $(GOCMD) build
GOINSTALL       := $(GOCMD) install
GOCLEAN         := $(GOCMD) clean
GOTEST          := $(GOCMD) test
GOGET           := $(GOCMD) get
GOLINT          := golint
BINARY_NAME     := ttha
GO_FILES        := $(shell find . -name '*.go' | grep -v _test.go)
NAME            := $(PROJECT)
GIT_COMMIT      ?= $(shell git rev-parse --short HEAD)

.PHONY: help clean lint build-linux build-mac dep

# HELP
help: ## Help me.
	@awk 'BEGIN {FS = ":.*?## "} /^[a-zA-Z_-]+:.*?## / {printf "\033[36m%-30s\033[0m %s\n", $$1, $$2}' $(MAKEFILE_LIST)

test:
	$(GOTEST) ./... -v

clean: ## Clean Project
	@echo "==> Clean project..."
	$(GOCLEAN)
	rm -f $(BINARY_NAME)
	rm -f $(BINARY_NAME).tar.gz

lint: ## Lint Project
	@echo "==> Lint project..."
	$(GOLINT) ./...

# Cross compilation
build-linux: dep ## Build linux artifact
	@echo "==> Build Linux artifact..."
	CGO_ENABLED=0 GOOS=linux GOARCH=amd64 $(GOBUILD) -o $(BINARY_NAME) -v

build-mac: dep ## Build linux artifact
	@echo "==> Build OSX artifact..."
	CGO_ENABLED=0 GOOS=darwin GOARCH=amd64 $(GOBUILD) -o $(BINARY_NAME) -v

package: build ## Package source code
	@echo "==> Package source code..."
	tar -czvf $(PROJECT_NAME).tar.gz $(BINARY_NAME)

build-docker: ## Build docker image with buildkit
	@echo "==> Package source code..."
	DOCKER_BUILDKIT=1 docker build -t ttha .

# helpers
dep: ## Install deps
	@echo "==> Installing dependencies..."
	$(GOGET) -v -d ./...
	$(GOGET) -u golang.org/x/lint/golint

fmt:
	@echo "==> Fixing source code with gofmt..."
	gofmt -s -w ./main.go ./meta.go ./cmd
--- /home/saidler/slam/tatari-tv/hiring-homework/solutions/hiring_2020/jason_harley/Makefile ---
.PHONY: up clean test

all: up

up:
	vagrant up

clean:
	vagrant destroy

test:
	vagrant up
	vagrant destroy -f
--- /home/saidler/slam/tatari-tv/hiring-homework/solutions/hiring_2020/prasanna_shevade/Makefile ---
PROJECT = cpv

test: 
	go test -v

build: test
	go build -v -o ${PROJECT}

run: build
	./${PROJECT}
--- /home/saidler/slam/tatari-tv/hiring-homework/solutions/hiring_2020/vince_nicoara/Makefile ---
run:
	python main.py
build:
	pip install colorama
test:
	python tests.py--- /home/saidler/slam/tatari-tv/python-tatari-data-common/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_data_common tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/tatari-great-expectations/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_great_expectations tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/creative-analysis-service/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=creative_analysis_service tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-pyspark-data-models/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_pyspark_data_models tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-tv-time/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install --all-extras


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_tv_time tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-lambda-utils/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_lambda_utils tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/airflow-dags/Makefile ---
.DEFAULT_GOAL: build

# Build targets


.PHONY: build
build:
	docker compose build .


.PHONY: up
up:
	docker compose up

.PHONY: down
down:
	docker compose down

.PHONY: delete
delete:
	docker compose down --volumes

export PYPI_USERNAME
export PYPI_PASSWORD
export AIRFLOW_UID = $(id -u)
.PHONY: test
test:
	docker build -t airflow-dags . --build-arg PYPI_USERNAME=$(PYPI_USERNAME) --build-arg PYPI_PASSWORD=$(PYPI_PASSWORD)
	IMAGE=airflow-dags docker compose -f docker-compose.actions.yaml run --quiet-pull -T --rm airflow-test



export PYPI_USERNAME
export PYPI_PASSWORD
export AIRFLOW_UID = $(id -u)
.PHONY: mypy
mypy:
	@docker build -t airflow-dags . --build-arg PYPI_USERNAME=$(PYPI_USERNAME) --build-arg PYPI_PASSWORD=$(PYPI_PASSWORD)
	IMAGE=airflow-dags docker compose -f docker-compose.actions.yaml run --quiet-pull -T --rm airflow-test bash -c "mypy"

.PHONY: pre-commit
pre-commit:
	pre-commit install
	pre-commit run --all-files

.PHONY: image-tag-branch-pre-commit
image-tag-branch-pre-commit:
	pre-commit install -c .image-tag-branch-pre-commit-config.yaml
	pre-commit run --all-files -c .image-tag-branch-pre-commit-config.yaml

# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .tox/ .venv/ .mypy_cache/ .pytest_cache/ .airflow/ .venv-test/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
	docker compose down --volumes
--- /home/saidler/slam/tatari-tv/python-tatari-pyspark-calculations/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_pyspark_calculations --durations=10 tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-s3-archiver/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/solutions-toolbox/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=solutions_toolbox tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/ephemeral-db/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=ephemeral_db tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/ml-cookiecutter/ml-{{ cookiecutter.app_name.replace("_", "-") }}/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files

# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build

.PHONY: github-release
github-release:
	poetry run ./github-release.sh

# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/ml-cookiecutter/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: clean dev lint

# Dev
.PHONY: dev
dev:
	poetry install

# Testing related targets
.PHONY: lint
lint:
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .tox/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-task-queue-proto/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install

# regenerate proto messages
.PHONY: gen
gen:
	protoc -I./protoc --python_out . protoc/tatari_taskqueue_proto/defs/*.proto
	protoc -I./protoc --python_out . protoc/tatari_taskqueue_proto/*.proto
	for i in 1 2; do $(MAKE) lint; done

# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_taskqueue_proto tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint:
	poetry run pre-commit run --all-files -v

.PHONY: test
test: lint type-check unit-test

# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-pyspark-tools/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/pingpong/makefile ---
VERSION := $(shell node -e 'console.log(require("./package.json").version)')
SED := $(shell [ "$$(uname)" = "Darwin" ] && echo "sed -i.bak" || echo "sed -i" )

LIB_URL := https:\/\/d2hrivdxn8ekm8.cloudfront.net
TRACK_URL := https:\/\/tte-prod.telemetry.vaultdcr.com\/5a28e627
IP4_TRACK_URL := https:\/\/ttip-ipv4-prod.telemetry.vaultdcr.com\/5a28e627
IP6_TRACK_URL := https:\/\/ttip-ipv6-prod.telemetry.vaultdcr.com\/5a28e627

TEST_URL := http:\/\/localhost:8055

.PHONY: all
all: build/tracker-snippet-latest.js build/tatari-shopify/tracker-snippet-latest.min.js philo build/ttm/tag-manager-snippet-latest-test.js build/ttm/tag-manager-latest.js build/tracker-latest-test.js build/tracker-snippet-latest-test.js build/tracker-latest.min.js build/tracker-snippet-latest.min.js
	echo "Package version: $(VERSION)"
	$(SED) "s/{{LIB_URL}}/$(LIB_URL)/g" build/*.js
	$(SED) "s/{{TRACK_URL}}/$(TRACK_URL)/g" build/*.js
	$(SED) "s/{{LIB_NAME}}/tracker-$(VERSION).min.js/g" build/tracker-snippet-$(VERSION).min.js
	$(SED) "s/{{LIB_NAME}}/tracker-latest.js/g" build/tracker-snippet-latest.js

	# remove sed artifacts
	find build/ -name "*.bak" -type f -delete

build/tracker-snippet-latest.min.js: build/tracker-snippet-$(VERSION).min.js
	cp $? $@
	$(SED) "s/{{LIB_NAME}}/tracker-latest.min.js/g" build/tracker-snippet-latest.min.js

build/tracker-latest.min.js: build/tracker-$(VERSION).min.js
	cp $? $@

build/tracker-snippet-latest-test.js: build/tracker-snippet-latest.js
	cp $? $@
	$(SED) "s/{{LIB_URL}}/$(TEST_URL)/g" $@
	$(SED) "s/{{TRACK_URL}}/$(TEST_URL)/g" $@
	$(SED) "s/{{LIB_NAME}}/build\/tracker-latest-test.js/g" build/tracker-snippet-latest-test.js

build/tracker-latest-test.js: build/tracker-latest.js
	cp $? $@
	$(SED) "s/{{LIB_URL}}/$(TEST_URL)/g" $@
	$(SED) "s/{{TRACK_URL}}/$(TEST_URL)/g" $@

build/tracker-$(VERSION).min.js build/tracker-snippet-$(VERSION).min.js: build/tracker%-$(VERSION).min.js: build/tracker%-latest.js
	./node_modules/.bin/uglifyjs $? -o $@ --mangle --compress --enclose

build/tracker-latest.js: tracker/tracker.ts
	./node_modules/.bin/tsc $? --outDir build --module UMD
	mv build/tracker.js $@
	$(SED) "s/{{VERSION}}/$(VERSION)/g" $@
	$(SED) "s/{{IP4_TRACK_URL}}/$(IP4_TRACK_URL)/g" build/*.js
	$(SED) "s/{{IP6_TRACK_URL}}/$(IP6_TRACK_URL)/g" build/*.js

build/tracker-snippet-latest.js: tracker/tracker-snippet.ts
	./node_modules/.bin/tsc $? --outDir build --module UMD
	mv build/tracker-snippet.js $@
	$(SED) "s/{{VERSION}}/$(VERSION)/g" $@

build/tatari-shopify/tracker-snippet-latest.min.js: build/tatari-shopify/tracker-snippet-latest-test.js
	# replace lib url with backticked tracker url
	$(SED) "s/{{LIB_URL}}\/{{LIB_NAME}}/$(LIB_URL)\/tag-manager\/' + token + '-latest\.js/g" build/tatari-shopify/*.js

	# replace version with package version
	$(SED) "s/{{VERSION}}/$(VERSION)/g" build/tatari-shopify/*.js

	# minify after all replacements
	./node_modules/.bin/uglifyjs build/tatari-shopify/tracker-snippet-latest.js -o $@ --mangle --compress --enclose

build/tatari-shopify/tracker-snippet-latest-test.js: build/tatari-shopify/tracker-snippet-latest.js
	cp $? $@
	$(SED) "s/{{LIB_NAME}}/build\/tracker-latest-test.js/g" $@
	$(SED) "s/{{LIB_URL}}/$(TEST_URL)/g" $@

build/tatari-shopify/tracker-snippet-latest.js: tatari-shopify/tracker-snippet.ts
	./node_modules/.bin/tsc $? --outDir build/tatari-shopify --module UMD
	mv build/tatari-shopify/tracker-snippet.js $@
	$(SED) -e "/{{LOAD_SNIPPET}}/{r build/tracker-snippet-latest.js" -e "d;}" $@

build/ttm/tag-manager-snippet-latest-test.js: build/ttm/tag-manager-snippet-latest.js
	cp $? $@
	$(SED) "s/{{TTM_LIB_URL}}/\/build\/ttm\/tag-manager-latest.js/g" build/ttm/*-test.js

build/ttm/tag-manager-latest.js build/ttm/tag-manager-snippet-latest.js: build/ttm/tag-manager%-latest.js: tag-manager/tag-manager%.ts
	./node_modules/.bin/tsc $? --outDir build/ttm --module UMD
	mv build/ttm/tag-manager$*.js $@

.PHONY: philo
philo: build/philo/abc_on_pageview.py build/philo/abc_snippet.py build/philo/abc_on_track.py build/philo/beeswax_pixel_on_pageview.py build/philo/beeswax_pixel_on_track.py build/philo/liveramp_on_pageview.py build/philo/liveramp_on_track.py build/philo/xandr_snippet.py build/philo/xandr_snippet-test.js build/philo/tag-manager-latest.py build/philo/tag-manager-snippet-latest.py build/philo/xandr_on_pageview.py build/philo/xandr_on_track.py
	# f string compatibility, replace vars with philo ones
	$(SED) "s/{/{{/g" build/philo/*.py
	$(SED) "s/}/}}/g" build/philo/*.py
	$(SED) "s/{{TTM_LIB_URL}}/{self.additional_scripts_cloudfront_url()}/g" build/philo/*.py
	$(SED) "s/'{{ON_TRACK}}';/{on_track or ''}/g" build/philo/*.py
	$(SED) "s/'{{ON_PAGEVIEW}}';/{on_pageview or ''}/g" build/philo/*.py
	$(SED) "s/'{{ON_IDENTIFY}}';/{on_identify or ''}/g" build/philo/*.py
	$(SED) "s/{{SLUG}}/{self.company.slug}/g" build/philo/*.py
	$(SED) "s/{{XANDR_ID}}/{self.xandr_id}/g" build/philo/*.py
	$(SED) "s/{{XANDR_GROUPS}}/{self.xandr_groups}/g" build/philo/*.py
	$(SED) "s/{{SEGMENT_KEY}}/{segment_key}/g" build/philo/*.py
	$(SED) "s/'{{SEGMENT_MAPPING}}'/{segment_mapping}/g" build/philo/*.py
	$(SED) "s/'{{EVENT}}'/event/g" build/philo/*.py

build/philo/tag-manager-latest.py build/philo/tag-manager-snippet-latest.py: build/philo/tag-manager%-latest.py: build/ttm/tag-manager%-latest.js
	cp $? $@

build/philo/xandr_on_pageview.py build/philo/xandr_on_track.py: build/philo/xandr_on_%.py: philo/xandr_on_%.js
	cp $? $@

build/philo/xandr_snippet.py: build/philo/xandr_snippet.js
	cp $? $@

build/philo/xandr_snippet-test.js: "build/philo/"
	cp build/philo/xandr_snippet.js $@
	$(SED) "s/{XANDR_ID}/fake-xandr-id-here/g" $@
	$(SED) "s/{XANDR_GROUPS}/2/g" $@

build/philo/abc_on_pageview.py build/philo/abc_snippet.py build/philo/abc_on_track.py build/philo/beeswax_pixel_on_pageview.py build/philo/beeswax_pixel_on_track.py build/philo/liveramp_on_pageview.py build/philo/liveramp_on_track.py: %.py: "build/philo/"
	mv $*.js $@

"build/philo/": philo/*.ts
	./node_modules/.bin/tsc $? --outDir build/philo --module UMD

.PHONY: clean
clean:
	rm -rf build/*

.PHONY: test
test:
	npm run test
	npm run lint

.PHONY: export
export: all
	## It's a matter of just porting the functionality of `pbcopy` but I don't have
	## linux in front of me.
	[ "$$(uname)" = "Darwin" ] || { echo "This only works on macOS :( Sorry" >&2; exit 1; }

	##
	## Adding the contents of snippets to the clipboard one at a time
	##

	for file in build/philo/*.py; do \
		pbcopy < $$file; \
		read -p "Copied to clipboard for $$file [Enter to continue]"; \
	done
--- /home/saidler/slam/tatari-tv/python-tatari-reach-frequency-prediction/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_reach_frequency_prediction tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-data-catalog/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_data_catalog tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/philo/Makefile ---
# If the first argument is "container-test"...
ifeq (container-test,$(firstword $(MAKECMDGOALS)))
  # use the rest as arguments for "run"
  PYTEST_PATHS := $(wordlist 2,$(words $(MAKECMDGOALS)),$(MAKECMDGOALS))
  # ...and turn them into do-nothing targets
  $(eval $(PYTEST_PATHS):;@:)
endif

mkfile_path := $(abspath $(lastword $(MAKEFILE_LIST)))
mkfile_dir := $(dir $(mkfile_path))

.DEFAULT_GOAL := dev

.PHONY: local-release
local-release: unit-test type-check lint sdist release

# Dev targets
.PHONY: build
build:
	docker build \
		--secret id=NETRC,src=${HOME}/.netrc \
		-t philo:${USER}-$(git describe --always) \
		--target base \
		.

.PHONY: dep-install
dep-install:
	poetry install --all-extras

.PHONY: dep-install-dev
dep-install-dev:
	poetry install --only dev

.PHONY: dev
dev:
	docker compose up --build -d

.PHONY: dev-down
dev-down:
	docker compose down
	docker image prune -f

.PHONY: dev-load-data
dev-load-data:
	docker compose stop
	docker compose create --build
	docker compose start postgres
	docker compose run -i --rm --no-deps \
		-e PGPASSWORD=postgres \
		-e AWS_ACCESS_KEY_ID \
		-e AWS_SECRET_ACCESS_KEY \
		-e AWS_SESSION_TOKEN \
		--entrypoint "poetry run python -m script.ops.pg_dump" \
		--volume $(PWD)/schema:/app/schema:Z \
		--volume $(PWD)/script:/app/script:Z \
		devserver --host postgres --user postgres --dbname philo_local restore
	docker compose up --build -d


.PHONY: dev-logs
dev-logs:
	docker compose logs -f

.PHONY: dev-stop
dev-stop:
	docker compose stop

# Testing related targets
.PHONY: unit-test
unit-test: dep-install dep-install-dev
	poetry run pytest

.SILENT:
.PHONY: container-test
container-test:
	printf "Ensuring PostgreSQL container is running with migrations applied..."
	docker compose -f docker-compose.actions.yml up --build --remove-orphans -d migrations > /dev/null 2>&1 && printf "OK\n" || /bin/sh -c "printf \"ERROR\nCheck output after running 'docker compose -f docker-compose.actions.yml up --remove-orphans -d migrations'\n\"; exit 1"
	printf "Cleaning old test container runs..."
	docker rm -f philo-pytest-container-test > /dev/null 2>&1 && printf "OK\n" || /bin/sh -c "printf \"ERROR\nCheck output after running 'docker rm philo-pytest-container-test'\n\"; exit 1"
	printf "Running tests in container...\n"
	PYTEST_GROUP=1 \
		PYTEST_SPLITS=1 \
		docker compose -f docker-compose.actions.yml run -T --no-deps \
			--name philo-pytest-container-test \
			--entrypoint "/bin/bash -c \"poetry install --all-extras && poetry run pytest $(PYTEST_PATHS)\"" \
			--volume $(PWD)/.coveragerc:/app/.coveragerc:Z \
			--volume $(PWD)/coverage-data:/app/coverage-data:Z \
			--volume $(PWD)/philo:/app/philo:Z \
			--volume $(PWD)/poetry.lock:/app/poetry.lock:Z \
			--volume $(PWD)/pyproject.toml:/app/pyproject.toml:Z \
			--volume $(PWD)/schema:/app/schema:Z \
			--volume $(PWD)/script:/app/script:Z \
			--volume $(PWD)/tests:/app/tests:Z \
			pytest

.PHONY: type-check
type-check: dep-install dep-install-dev
	poetry run mypy

.PHONY: lint
lint: dep-install dep-install-dev
	poetry run pre-commit run --all-files --verbose

.PHONY: poly-check
poly-check:
	poetry poly check \
    --alias google-api-python-client=apiclient,google,googleapiclient \
    --alias graphql-core=graphql \
    --alias grpcio=grpc \
    --alias hubspot-api-client=hubspot \
    --alias opencv-python=cv2 \
    --alias opencv-python-headless=cv2 \
    --alias pycryptodomex=cryptodome \
    --alias pyjwt=jwt \
    --alias python-datauri=datauri \
    --alias python-dateutil=dateutil \
    --alias scikit-learn=sklearn \
    --alias tatari-environments=tatari_buying_execution

.PHONY: poly-reorg-restruct
poly-reorg-restruct: dep-install-dev
	poetry run python ${mkfile_dir}/polylith_setup/reorganize.py reorganize
	${mkfile_dir}/polylith_setup/restructure.sh

# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/philo/projects/admin/Makefile ---
.PHONY: dev-load-data
dev-load-data:
	docker compose stop
	docker compose create --build
	docker compose start postgres
	docker compose run -i --rm --no-deps \
		-e AWS_ACCESS_KEY_ID \
		-e AWS_SECRET_ACCESS_KEY \
		-e AWS_SESSION_TOKEN \
		-e PGPASSWORD=postgres \
		--entrypoint "poetry run python -m script.ops.pg_dump" \
		--volume $(PWD)/../../schema:/app/schema:Z \
		--volume $(PWD)/../../script:/app/script:Z \
		devserver --host postgres --user postgres --dbname philo_admin_local restore
	docker compose up --build
--- /home/saidler/slam/tatari-tv/philo/projects/api-server/Makefile ---
.PHONY: dev
dev:
	poetry install --all-extras
	poetry build-project
	make --file=../../Makefile poly-check
	poetry run pip install dist/*.whl
	poetry run fastapi run --reload ../../bases/philo/api_server/app.py

.PHONY: dev-load-data
dev-load-data:
	docker compose stop
	docker compose create --build
	docker compose start postgres
	docker compose run -i --rm --no-deps \
		-e AWS_ACCESS_KEY_ID \
		-e AWS_SECRET_ACCESS_KEY \
		-e AWS_SESSION_TOKEN \
		-e PGPASSWORD=postgres \
		--entrypoint "poetry run python -m script.ops.pg_dump" \
		--volume $(PWD)/../../schema:/app/schema:Z \
		--volume $(PWD)/../../script:/app/script:Z \
		devserver --host postgres --user postgres --dbname philo_api_server_local restore
	docker compose up --build
--- /home/saidler/slam/tatari-tv/python-tatari-dev-llm-lab/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_dev_llm_lab tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/pyspark-data-export-jobs/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --durations=10 -n auto --cov=pyspark_my_app_jobs tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-mailgun-client/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_mailgun_client tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/auth-svc/Makefile ---
# define vars
CERTS_DIR	?= ./certs/tatari

.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


.PHONY: unit-test
unit-test: dev
	env ENV=ci poetry run pytest --junitxml=pytest.xml --cov=auth_svc tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files

# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete

# key generation
.PHONY: keygen
keygen:
	# Create separate directories for public and private keys
	mkdir -p $(CERTS_DIR)/public $(CERTS_DIR)/private

	# gen active.pem
	# generate active.pem private key and extract active.pem public key and put it in the public directory
	openssl genpkey -algorithm RSA -out $(CERTS_DIR)/private/active.pem -pkeyopt rsa_keygen_bits:2048
	openssl rsa -in $(CERTS_DIR)/private/active.pem -pubout -out $(CERTS_DIR)/public/active.pem

	# gen on_deck.pem
	# generate on_deck.pem private key and extract on_deck.pem public key and put it in the public directory
	openssl genpkey -algorithm RSA -out $(CERTS_DIR)/private/on_deck.pem -pkeyopt rsa_keygen_bits:2048
	openssl rsa -in $(CERTS_DIR)/private/on_deck.pem -pubout -out $(CERTS_DIR)/public/on_deck.pem

	@echo "Private keys stored in $(CERTS_DIR)/private/$(CLIENT_ID).pem"
	@echo "Public keys stored in $(CERTS_DIR)/public/$(CLIENT_ID).pem"
--- /home/saidler/slam/tatari-tv/data-analysis/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest  --junitxml=pytest.xml --cov=data_analysis tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-auth-client/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install --all-extras


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-airflow-provider/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_airflow_provider tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-ml-utils/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_ml_utils tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-llm-tools/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_llm_tools tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-environments/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_environments tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-csv-to-rds-importer/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-task-queue/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_task_queue tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: test
test: lint type-check unit-test

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-grey-shared/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_grey_shared tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-data-contracts/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_data_contracts tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/ml-creative-optimization/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files

# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build

.PHONY: github-release
github-release:
	poetry run ./github-release.sh

# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete

.PHONY: mlflow
mlflow:
	.venv/bin/mlflow server --backend-store-uri sqlite:///mlflow.db --default-artifact-root ./mlruns --host 0.0.0.0 --port 5001

.PHONY: train
train:
	curl -s http://localhost:5001 > /dev/null || (echo '--<! mlflow server not running !>--' && exit 1)
	sh -c "poetry run python -m script/run_creative_optimization_$(model)_training.py"

.PHONY: predict
predict:
	curl -s http://localhost:5001 > /dev/null || (echo '--<! mlflow server not running !>--' && exit 1)
	sh -c "poetry run python -m script/run_creative_optimization_$(model)_predict.py"
--- /home/saidler/slam/tatari-tv/python-tatari-metrics/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_metrics tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/ml-linear-clearance/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files

# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build

.PHONY: github-release
github-release:
	poetry run ./github-release.sh

# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-api-client/Makefile ---
.DEFAULT_GOAL:= dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# Build targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_api_client tests/unit


.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/helm-charts/datahub/Makefile ---
# Makefile
CHART_REPO_NAME   := datahub
CHART_REPO_URL    := https://helm.datahubproject.io/
CHART_NAME        := datahub
CHART_VERSION     := 0.4.28
CHART_VALUES_FILE := values.yaml
NAMESPACE         := datahub
OVERLAYS          := prod staging test
.DEFAULT_GOAL     := default

include ../Makefile.in

post-template:
	# Remove datahub-gms secret
	@cd ${MANIFEST_DIR}; kustomize edit remove resource ${CHART_NAME}/charts/datahub-frontend/templates/secrets.yaml
	@cd base; kustomize edit remove resource upstream/datahub/charts/datahub-frontend/templates/secrets.yaml
	@cd ${MANIFEST_DIR}; kustomize edit remove resource ${CHART_NAME}/charts/datahub-frontend/templates/secrets.yaml
	@cd ${MANIFEST_DIR}; kustomize edit remove resource ${CHART_NAME}/templates/datahub-encryption-secrets.yml
	@cd ${MANIFEST_DIR}; kustomize edit remove resource ${CHART_NAME}/templates/datahub-auth-secrets.yml
--- /home/saidler/slam/tatari-tv/helm-charts/datahub-prerequisites/Makefile ---
# Makefile
CHART_REPO_NAME   := datahub
CHART_REPO_URL    := https://helm.datahubproject.io/
CHART_NAME        := datahub-prerequisites
RELEASE_NAME      := datahub
CHART_VERSION     := 0.1.3
CHART_VALUES_FILE := values.yaml
NAMESPACE         := datahub
OVERLAYS          := prod staging test
.DEFAULT_GOAL     := default

include ../Makefile.in

kustomize:

post-template:
--- /home/saidler/slam/tatari-tv/tatari-admission-webhook/Makefile ---
# Image URL to use all building/pushing image targets
IMG ?= admission-webhook:latest

# Get the currently used golang install path (in GOPATH/bin, unless GOBIN is set)
ifeq (,$(shell go env GOBIN))
GOBIN=$(shell go env GOPATH)/bin
else
GOBIN=$(shell go env GOBIN)
endif

all: test fmt

.PHONY: test
test:
	go test ./...

.PHONY: fmt
fmt:
	go fmt ./...

.PHONY: cluster
cluster:
	@echo "\n Creating Kubernetes cluster..."
	kind create cluster --name webhook --config config/kind/cluster.yaml

.PHONY: apply
apply:
	@echo "\n Apply Kustomization"
	kubectl apply -k config/overlays/local

.PHONY: docker-build
docker-build:
	@echo "\n Building docker image..."
	docker build -t $(IMG) .

.PHONY: push
push: docker-build
	@echo "\n Pushing admission-webhook image into Kind's Docker daemon..."
	kind load docker-image --name webhook $(IMG)
	kubectl delete pod -n tatari-system -l app=tatari-admission-webhook

install-cert-manager:
	kubectl apply --validate=false -f https://github.com/jetstack/cert-manager/releases/download/v1.11.0/cert-manager.yaml

.PHONY: logs
logs:
	kubectl logs -n tatari-admission-webhook -l app=tatari-admission-webhook -f
--- /home/saidler/slam/tatari-tv/python-tatari-explainability/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install --extras pyspark


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build

.PHONY: github-release
github-release:
	poetry run ./github-release.sh


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tataribot/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tataribot tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-settings/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/persona-svc/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=persona tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-network-rotation-summaries/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=python_network_rotation_summaries tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/security-operations/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=security_operations tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-altinity-cloud/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install

# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_altinity_cloud tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete

.PHONY: k8s
k8s:
	sh ./hack/init.sh
--- /home/saidler/slam/tatari-tv/some-testserver/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	uv sync


# Testing related targets
.PHONY: test
test: dev
	uv run pytest

.PHONY: unit-test
unit-test: dev
	uv run pytest --junitxml=pytest.xml --cov=some_testserver tests/unit

.PHONY: integration-test
integration-test: dev
	uv run --no-project pytest tests/integration

.PHONY: type-check
type-check: dev
	uv run mypy

.PHONY: lint
lint: dev
	uv run --group dev pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-pyspark/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/security-infra/wiz-kubernetes-connector/Makefile ---
# Makefile
CHART_REPO_NAME   := wiz-sec
CHART_REPO_URL    := https://wiz-sec.github.io/charts
CHART_NAME        := wiz-kubernetes-connector
CHART_VERSION     := 2.4.9
CHART_VALUES_FILE := values.yaml
NAMESPACE         := wiz-system
OVERLAYS          := prod staging dev test ops apps
.DEFAULT_GOAL     := default

include ../Makefile.in
--- /home/saidler/slam/tatari-tv/security-infra/wiz-sensor/Makefile ---
# Makefile
CHART_REPO_NAME   := wiz-sec
CHART_REPO_URL    := https://wiz-sec.github.io/charts
CHART_NAME        := wiz-sensor
CHART_VERSION     := 1.0.4483
CHART_VALUES_FILE := values.yaml
NAMESPACE         := wiz-system
OVERLAYS          := prod staging dev test ops apps
.DEFAULT_GOAL     := default

include ../Makefile.in
--- /home/saidler/slam/tatari-tv/tatari-data-clean-room/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: install unit-test integration-test type-check lint

.PHONY: dev
dev:
	docker compose up --build -d
	docker compose watch

.PHONY: dev-down
dev-down:
	docker compose down
	pkill -fl docker.compose.*watch

.PHONY: dev-invoke-lambda
dev-invoke-lambda:
	curl -XPOST "http://localhost:8000/2015-03-31/functions/function/invocations" -d '{"some":"payload"}'

.PHONY: dev-logs
dev-logs:
	docker compose logs -f

.PHONY: dev-reset-aws-mock
dev-reset-aws-mock:
	docker compose restart localstack

.PHONY: install
install:
	poetry install

# Testing related targets
.PHONY: test
test: install
	poetry run pytest

.PHONY: unit-test
unit-test: install
	poetry run pytest --junitxml=pytest.xml --cov=vaultdcr tests/unit

.PHONY: integration-test
integration-test: install
	poetry run pytest tests/integration

.PHONY: type-check
type-check: install
	poetry run mypy

.PHONY: lint
lint: install
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete

.PHONY: deploy-info
deploy-info: ## Create deploy.info File.
	@echo "creating deploy.info file..."
	$(shell jq -n --arg author "$(GIT_AUTHOR)" --arg commit "$(GIT_COMMIT_DATETIME)" --arg describe "$(GIT_DESCRIBE)" --arg version "$(GIT_VERSION)" \
		'{"author": $$author, "commit_datetime": $$commit, "git_describe": $$describe, "status": "OK", "version": $$version}' > deploy.info)
--- /home/saidler/slam/tatari-tv/python-tatari-db/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install -E clickhouse -E asyncio


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest tests/unit

.PHONY: test
test: dev
	poetry run pytest

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-ga-util/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_ga_util tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/some-webserver/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=some_webserver tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/cloudwatch-logs-retention-manager/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=cloudwatch_logs_retention_manager tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-streaming-clearance-prediction/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_streaming_clearance_prediction tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-check-resources-proto/Makefile ---
.DEFAULT_GOAL := build

.PHONY: all
all: dev unit-test type-check lint sdist release

SRC_DIR:=tatari_check_resources_proto
PROTO_DIR:=$(SRC_DIR)/proto
PROTOS := $(wildcard $(PROTO_DIR)/*.proto $(PROTO_DIR)/*/*.proto)
PROTOS_GEN = $(patsubst $(PROTO_DIR)/%.proto, $(PROTO_DIR)/%_pb2_grpc.py, $(PROTOS)) \
	     $(patsubst $(PROTO_DIR)/%.proto, $(PROTO_DIR)/%_pb2.py, $(PROTOS))

# gRPC targets
.PHONY: proto
proto:
	poetry run python -m grpc_tools.protoc $(SRC_DIR)/proto/*.proto --python_out . --proto_path . --grpc_python_out . --mypy_out=.

# dev targets
.PHONY: dev
dev:
	poetry install

# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_check_resources_proto tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist: proto
	make -B proto
	poetry build -f sdist

.PHONY: release
release: proto
	poetry build

# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	rm -f $(PROTOS_GEN)
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/local-clickhouse-cluster/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint config up

.PHONY: config
config:
	rm -rf clickhouse01 clickhouse02
	mkdir -p clickhouse01 clickhouse02
	mkdir -p clickhouse01-data clickhouse01-data
	REPLICA=01 SHARD=01 envsubst < config.xml > clickhouse01/config.xml
	REPLICA=02 SHARD=01 envsubst < config.xml > clickhouse02/config.xml
	cp users.xml clickhouse01/users.xml
	cp users.xml clickhouse02/users.xml

.PHONY: up
up:
	docker compose up -d

.PHONY: start
start:
	docker compose start

.PHONY: stop
stop:
	docker compose stop

.PHONY: down
down:
	docker compose down

# make sure clickhouse01, clickhouse02 and zookeeper are running. For ci.
.PHONY: validate
validate:
	docker ps | grep clickhouse01 || exit 1
	docker ps | grep clickhouse02 || exit 1
	docker ps | grep zookeeper || exit 1

# Dev
.PHONY: dev
dev:
	poetry install

# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=local_clickhouse_cluster tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/pre-commit-hooks/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest tests/python

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-taskqueue-cookiecutter/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: clean dev lint

# Dev
.PHONY: dev
dev:
	poetry install

# Testing related targets
.PHONY: lint
lint:
	poetry run pre-commit run --all-files

gen:
	poetry run cookiecutter -o .. .

# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .tox/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete

update-base:
	git fetch base
	git merge --no-ff base/main --allow-unrelated-histories
--- /home/saidler/slam/tatari-tv/python-taskqueue-cookiecutter/{{ cookiecutter.app_name.replace("_", "-") }}/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov={{ cookiecutter.app_name }} tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/quickbooks-adapter/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# install venv on local machine
.PHONY: install
install:
	poetry install --all-extras

# create docker compose stack
.PHONY: dev
dev:
	docker compose up --build -d

# docker down
.PHONY: dev-down
dev-down:
	docker compose down

# docker stop
.PHONY: dev-stop
dev-stop:
	docker compose stop

# docker logs
.PHONY: dev-logs
dev-logs:
	docker compose logs -f

# run unit tests in container
.PHONY: dev-test
dev-test: dev
	docker exec -it quickbooks-adapter-app-1 bash -c "poetry install --all-extras && poetry run pytest -m 'unit or integration' -s $(PYTEST_ARGS)"


# this executes the unit and integration tests
# tests marked unit or integration do not have dependencies external to QBA
.PHONY: test
test:
	env ENV=local poetry run pytest -m "unit or integration" $(PYTEST_ARGS)

# this executes the system tests with default configuration of staging environment
# tests marked system do have dependencies external to QBA, such as vault and QBO backend
.PHONY: test-system
test-system: install
	poetry run pytest -m "system"

.PHONY: type-check
type-check:
	poetry run mypy

.PHONY: lint
lint:
	poetry run pre-commit run --all-files

# Clean
.PHONY: clean
clean:
	docker rmi $(docker images | grep none | awk '{print $3}')
	rm -rf build/ dist/ .tox/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -exec rm -rf {} +
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/fail-whale/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# # Dev
# .PHONY: dev
# dev:
# 	poetry install


# # Testing related targets
# .PHONY: test
# test: dev
# 	echo "Test"
# #	poetry run py.test

# .PHONY: unit-test
# unit-test: dev
# 	poetry run py.test tests/unit

# .PHONY: integration-test
# integration-test: dev
# 	poetry run py.test tests/integration

.PHONY: lint
lint:
	pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-analysis-data-utils/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_analysis_data_utils tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/github-required-workflows/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: clean dev lint

# Dev
.PHONY: dev
dev:
	poetry install

# Testing related targets
.PHONY: lint
lint:
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .tox/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-package-cookiecutter/python-{{ cookiecutter.package_name.replace("_", "-") }}/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build

.PHONY: github-release
github-release:
	poetry run ./github-release.sh


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-package-cookiecutter/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: clean dev lint

# Dev
.PHONY: dev
dev:
	poetry install

# Testing related targets
.PHONY: lint
lint:
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .tox/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/partner-provisioning-service/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install

.PHONY: rebuild_env
rebuild_env:
	rm -rf .venv
	python3.11 -m venv .venv
	. .venv/bin/activate
	poetry install --all-extras

.PHONY: teardown_db
teardown_db:
	docker compose down
	docker volume rm partner-provisioning-service_db

.PHONY: build
build:
	aws-vault exec main-ro -- docker compose up --build

# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=partner_provisioning_service tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/farnsworth/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install

.PHONY: docker-build
docker-build: dev
	aws-vault exec tatari-ro -- docker compose build

.PHONY: docker-up
docker-up: docker-build
	docker compose up

.PHONY: docker-down
docker-down:
	docker compose down

.PHONY: run-client
run-client:
	cd client && npm install && PORT=3333 npm run dev

.PHONY: run-server
run-server:
	poetry run uvicorn farnsworth.app:app --reload --port 8888 --host 0.0.0.0

# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: eslint
eslint:
	cd client && npx eslint .

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/ml-streaming-performance/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install
	poetry run pip install scikit-surprise==1.1.4

.PHONY: dev-mac
dev-local: dev
	brew install libomp


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest tests/unit

.PHONY: test-integration
test-integration: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files

# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build

.PHONY: github-release
github-release:
	poetry run ./github-release.sh

# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete

.PHONY: mlflow
mlflow:
	.venv/bin/mlflow server --backend-store-uri sqlite:///mlflow.db --default-artifact-root ./mlruns --host 0.0.0.0 --port 5001

.PHONY: train
train:
	curl -s http://localhost:5001 > /dev/null || (echo '--<! mlflow server not running !>--' && exit 1)
	sh -c "poetry run python -m script.run_streaming_performance_$(model)_training"

.PHONY: predict
predict:
	curl -s http://localhost:5001 > /dev/null || (echo '--<! mlflow server not running !>--' && exit 1)
	sh -c "poetry run python -m script.run_streaming_performance_$(model)_predict"
--- /home/saidler/slam/tatari-tv/python-tatari-pyspark-performance-report/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml tests/unit

# Testing related targets
.PHONY: integration-test
integration-test: dev
	poetry run pytest --junitxml=pytest.xml tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/data-sources/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=data_sources tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/private-helm-charts/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: clean dev lint

# Dev
.PHONY: dev
dev:
	poetry install

# Testing related targets
.PHONY: lint
lint:
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .tox/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/philo-ai/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-ip-enrichment/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_ip_enrichment tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-experian-utils/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install

# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_experian_utils tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-data-simulations/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_data_simulations tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/ml-notebook-example/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files

# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build

.PHONY: github-release
github-release:
	poetry run ./github-release.sh

# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/deployments/Makefile ---
GIT_DESCRIBE	:= $(shell git describe --always --abbrev=7)
PYPI_USERNAME	?= $(shell cat ~/.config/pip/pip.conf | grep extra-index-url | awk -F '[//|@]' '{print $$3}' | awk -F '[:]' '{print $$1}')
PYPI_PASSWORD	?= $(shell cat ~/.config/pip/pip.conf | grep extra-index-url | awk -F '[//|@]' '{print $$3}' | awk -F '[:]' '{print $$2}')
.DEFAULT_GOAL := dev

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test:
	poetry run pytest

.PHONY: unit-test
unit-test:
	poetry run pytest --junitxml=pytest.xml --cov=deployments tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check:
	poetry run mypy

.PHONY: lint
lint:
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .tox/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete

docker-compose-build:
	docker compose build --build-arg PYPI_USERNAME="$(PYPI_USERNAME)" --build-arg PYPI_PASSWORD="$(PYPI_PASSWORD)" --build-arg GIT_DESCRIBE="$(GIT_DESCRIBE)"

docker-compose: docker-compose-build
	docker compose -f docker-compose.yaml up

docker-compose-down:
	docker compose -f docker-compose.yaml down

docker-compose-clean:
	@echo "Deleting deployments volumes and containers..."
	docker ps -a | grep 'deployments'  | awk -F ' ' '{print $$1}' | xargs -I {} sh -c "docker rm -f {}"
	docker volume list | grep 'deployments' | awk -F ' ' '{print $$2}' | xargs -I {} sh -c "docker volume rm -f {}"
--- /home/saidler/slam/tatari-tv/tf-anomaly-detection/Makefile ---
.DEFAULT_GOAL: dev

# Dev
.PHONY: dev
dev:
	poetry install
	@pre-commit install || (echo "Please install the pre-commit tool and rerun 'make' to install hooks."; exit 1)


# Testing related targets
.PHONY: test
test:
	poetry run pytest --junitxml=pytest.xml --cov=tf_anomaly_detection tests/unit

.PHONY: mypy
mypy:
	poetry run mypy

.PHONY: pre-commit
pre-commit:
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .tox/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/pyspark-ingestion-jobs/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --durations=10 -n auto --cov=pyspark_ingestion_jobs tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/apigw-lambdas/Makefile ---
# Check that given variables are set and all have non-empty values,
# die with an error otherwise.
#
# Params:
#   1. Variable name(s) to test.
#   2. (optional) Error message to print.
check_defined = \
    $(strip $(foreach 1,$1, \
        $(call __check_defined,$1,$(strip $(value 2)))))
__check_defined = \
    $(if $(value $1),, \
      $(error Undefined $1$(if $2, ($2))))

.PHONY: help
help: ## This help dialog.
	@IFS=$$'\n' ; \
	help_lines=(`fgrep -h "##" $(MAKEFILE_LIST) | fgrep -v fgrep | sed -e 's/\\$$//' | sed -e 's/##/:/'`); \
	printf "%-30s %s\n" "target" "details" ; \
	printf "%-30s %s\n" "------" "----" ; \
	for help_line in $${help_lines[@]}; do \
		IFS=$$':' ; \
		help_split=($$help_line) ; \
		help_command=`echo $${help_split[0]} | sed -e 's/^ *//' -e 's/ *$$//'` ; \
		help_info=`echo $${help_split[2]} | sed -e 's/^ *//' -e 's/ *$$//'` ; \
		printf '\033[36m'; \
		printf "%-30s %s" $$help_command ; \
		printf '\033[0m'; \
		printf "%s\n" $$help_info; \
	done

.PHONY: lint
lint: ## Lint Python and Terraform.
	@echo "linting source code..."
	pre-commit run --all-files

.PHONY: unit-test
unit-test: deploy-info ## Run Unit Tests.
	@echo "running unit tests..."
	poetry run python -m pytest --junitxml=pytest.xml --cov -vvvv tests/unit

.PHONY: deploy-info
deploy-info: ## Create deploy.info File.
	@echo "creating deploy.info file..."
	$(shell jq -n --arg author "$(GIT_AUTHOR)" --arg commit "$(GIT_COMMIT_DATETIME)" --arg describe "$(GIT_DESCRIBE)" --arg version "$(GIT_VERSION)" \
		'{"author": $$author, "commit_datetime": $$commit, "git_describe": $$describe, "status": "OK", "version": $$version}' > deploy.info)
--- /home/saidler/slam/tatari-tv/python-tatari-statuspage-client/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-analysis-jobs/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_analysis_jobs tests/unit


.PHONY: type-check
type-check: dev
	poetry run mypy -p tatari_analysis_jobs

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/devs/Makefile ---
.DEFAULT_GOAL := build

# go source files, ignore vendor directory
SRC = $(shell find . -type f -name '*.go' -not -path "./vendor/*")

VERSION := $(shell git describe --tags --always --dirty)
BUILD := `git rev-parse HEAD`

LDFLAGS=-ldflags "-X=main.Version=$(VERSION) -X=main.Build=$(BUILD)"

.PHONY: all
all: unit-test type-check lint build

.PHONY: build
build:
	mkdir -p dist
	go build -o dist/devs cmd/devs/main.go

.PHONY: run
run: build
	./dist/devs 2> err.log

# Testing related targets
.PHONY: unit-test
unit-test:
	go test -cover -coverprofile=coverage.txt ./...

.PHONY: test
test: unit-test

.PHONY: coverage
coverage: unit-test
	go tool cover -html=coverage.txt

.PHONY: fmt
fmt:
	gofmt -l -w $(SRC)

.PHONY: type-check
type-check:
	go run honnef.co/go/tools/cmd/staticcheck@v0.5.1 ./...

.PHONY: lint
lint: fmt

# Clean
.PHONY: clean
clean:
	rm -rf dist/
	rm -rf .coverage
--- /home/saidler/slam/tatari-tv/python-some-package/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=some_package tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/pyspark-data-infra-jobs/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --durations=10 -n auto --cov=pyspark_data_infra_jobs tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-xandr-client/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=xandr_client tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-media-planning-service-models/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build

.PHONY: github-release
github-release:
	poetry run ./github-release.sh


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-hubspot-client/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build

.PHONY: github-release
github-release:
	poetry run ./github-release.sh


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-data-logging/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_data_logging tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/slack-ai/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=slack_ai tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-pyspark-framework/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_pyspark_framework tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-user-agents/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_user_agents tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/tatari-cronjob-operator/Makefile ---

# Image URL to use all building/pushing image targets
IMG ?= controller:latest
# ENVTEST_K8S_VERSION refers to the version of kubebuilder assets to be downloaded by envtest binary.
ENVTEST_K8S_VERSION = 1.30.0

# Get the currently used golang install path (in GOPATH/bin, unless GOBIN is set)
ifeq (,$(shell go env GOBIN))
GOBIN=$(shell go env GOPATH)/bin
else
GOBIN=$(shell go env GOBIN)
endif

# Setting SHELL to bash allows bash commands to be executed by recipes.
# Options are set to exit when a recipe line exits non-zero or a piped command fails.
SHELL = /usr/bin/env bash -o pipefail
.SHELLFLAGS = -ec

.PHONY: all
all: build

##@ General

# The help target prints out all targets with their descriptions organized
# beneath their categories. The categories are represented by '##@' and the
# target descriptions by '##'. The awk commands is responsible for reading the
# entire set of makefiles included in this invocation, looking for lines of the
# file as xyz: ## something, and then pretty-format the target and help. Then,
# if there's a line with ##@ something, that gets pretty-printed as a category.
# More info on the usage of ANSI control characters for terminal formatting:
# https://en.wikipedia.org/wiki/ANSI_escape_code#SGR_parameters
# More info on the awk command:
# http://linuxcommand.org/lc3_adv_awk.php

.PHONY: help
help: ## Display this help.
	@awk 'BEGIN {FS = ":.*##"; printf "\nUsage:\n  make \033[36m<target>\033[0m\n"} /^[a-zA-Z_0-9-]+:.*?##/ { printf "  \033[36m%-15s\033[0m %s\n", $$1, $$2 } /^##@/ { printf "\n\033[1m%s\033[0m\n", substr($$0, 5) } ' $(MAKEFILE_LIST)

##@ Development

.PHONY: manifests
manifests: controller-gen ## Generate WebhookConfiguration, ClusterRole and CustomResourceDefinition objects.
	$(CONTROLLER_GEN) rbac:roleName=manager-role crd webhook paths="./..." output:crd:artifacts:config=config/crd/bases

.PHONY: generate
generate: controller-gen ## Generate code containing DeepCopy, DeepCopyInto, and DeepCopyObject method implementations.
	$(CONTROLLER_GEN) object:headerFile="hack/boilerplate.go.txt" paths="./..."

.PHONY: fmt
fmt: ## Run go fmt against code.
	go fmt ./...

.PHONY: vet
vet: ## Run go vet against code.
	go vet ./...

.PHONY: test
test: manifests generate fmt vet envtest ## Run tests.
	KUBEBUILDER_ASSETS="$(shell $(ENVTEST) use $(ENVTEST_K8S_VERSION) --bin-dir $(LOCALBIN) -p path)" go test ./... -coverprofile cover.out

##@ Build

.PHONY: cluster
cluster:
	@echo "\n Creating Kubernetes cluster..."
	kind create cluster --name cronjob --config config/samples/cluster.yaml

.PHONY: build
build: generate fmt vet ## Build manager binary.
	go build -o bin/manager main.go

.PHONY: run
run: manifests generate fmt vet ## Run a controller from your host.
	go run ./main.go

# If you wish built the manager image targeting other platforms you can use the --platform flag.
# (i.e. docker build --platform linux/arm64 ). However, you must enable docker buildKit for it.
# More info: https://docs.docker.com/develop/develop-images/build_enhancements/
.PHONY: docker-build
docker-build: test ## Build docker image with the manager.
	@echo "\n Building docker image..."
	docker build -t $(IMG) .

.PHONY: docker-push
docker-push: ## Push docker image with the manager.
	docker push ${IMG}

.PHONY: load
load: docker-build ## Load docker image with the controller into the kind cluster.
	@echo "\n Pushing controller image into Kind's Docker daemon..."
	kind load docker-image --name cronjob $(IMG)

# PLATFORMS defines the target platforms for  the manager image be build to provide support to multiple
# architectures. (i.e. make docker-buildx IMG=myregistry/mypoperator:0.0.1). To use this option you need to:
# - able to use docker buildx . More info: https://docs.docker.com/build/buildx/
# - have enable BuildKit, More info: https://docs.docker.com/develop/develop-images/build_enhancements/
# - be able to push the image for your registry (i.e. if you do not inform a valid value via IMG=<myregistry/image:<tag>> than the export will fail)
# To properly provided solutions that supports more than one platform you should use this option.
PLATFORMS ?= linux/arm64,linux/amd64,linux/s390x,linux/ppc64le
.PHONY: docker-buildx
docker-buildx: test ## Build and push docker image for the manager for cross-platform support
	# copy existing Dockerfile and insert --platform=${BUILDPLATFORM} into Dockerfile.cross, and preserve the original Dockerfile
	sed -e '1 s/\(^FROM\)/FROM --platform=\$$\{BUILDPLATFORM\}/; t' -e ' 1,// s//FROM --platform=\$$\{BUILDPLATFORM\}/' Dockerfile > Dockerfile.cross
	- docker buildx create --name project-v3-builder
	docker buildx use project-v3-builder
	- docker buildx build --push --platform=$(PLATFORMS) --tag ${IMG} -f Dockerfile.cross
	- docker buildx rm project-v3-builder
	rm Dockerfile.cross

##@ Deployment

ifndef ignore-not-found
  ignore-not-found = false
endif

.PHONY: install
install: manifests kustomize ## Install CRDs into the K8s cluster specified in ~/.kube/config.
	$(KUSTOMIZE) build config/crd | kubectl apply -f -

.PHONY: uninstall
uninstall: manifests kustomize ## Uninstall CRDs from the K8s cluster specified in ~/.kube/config. Call with ignore-not-found=true to ignore resource not found errors during deletion.
	$(KUSTOMIZE) build config/crd | kubectl delete --ignore-not-found=$(ignore-not-found) -f -

.PHONY: deploy
deploy: manifests kustomize ## Deploy controller to the K8s cluster specified in ~/.kube/config.
	cd config/manager && $(KUSTOMIZE) edit set image controller=${IMG}
	$(KUSTOMIZE) build config/default | kubectl apply -f -

.PHONY: undeploy
undeploy: ## Undeploy controller from the K8s cluster specified in ~/.kube/config. Call with ignore-not-found=true to ignore resource not found errors during deletion.
	$(KUSTOMIZE) build config/default | kubectl delete --ignore-not-found=$(ignore-not-found) -f -

##@ Build Dependencies

## Location to install dependencies to
LOCALBIN ?= $(shell pwd)/bin
$(LOCALBIN):
	mkdir -p $(LOCALBIN)

## Tool Binaries
KUSTOMIZE ?= $(LOCALBIN)/kustomize
CONTROLLER_GEN ?= $(LOCALBIN)/controller-gen
ENVTEST ?= $(LOCALBIN)/setup-envtest

## Tool Versions
KUSTOMIZE_VERSION ?= v5.4.3
CONTROLLER_TOOLS_VERSION ?= v0.16.1

KUSTOMIZE_INSTALL_SCRIPT ?= "https://raw.githubusercontent.com/kubernetes-sigs/kustomize/master/hack/install_kustomize.sh"
.PHONY: kustomize
kustomize: $(KUSTOMIZE) ## Download kustomize locally if necessary.
$(KUSTOMIZE): $(LOCALBIN)
	test -s $(LOCALBIN)/kustomize || { curl -Ss $(KUSTOMIZE_INSTALL_SCRIPT) | bash -s -- $(subst v,,$(KUSTOMIZE_VERSION)) $(LOCALBIN); }

.PHONY: controller-gen
controller-gen: $(CONTROLLER_GEN) ## Download controller-gen locally if necessary.
$(CONTROLLER_GEN): $(LOCALBIN)
	test -s $(LOCALBIN)/controller-gen || GOBIN=$(LOCALBIN) go install sigs.k8s.io/controller-tools/cmd/controller-gen@$(CONTROLLER_TOOLS_VERSION)

.PHONY: envtest
envtest: $(ENVTEST) ## Download envtest-setup locally if necessary.
$(ENVTEST): $(LOCALBIN)
	test -s $(LOCALBIN)/setup-envtest || GOBIN=$(LOCALBIN) go install sigs.k8s.io/controller-runtime/tools/setup-envtest@latest
--- /home/saidler/slam/tatari-tv/pyspark-feature-jobs/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
 all: dev unit-test integration-test type-check lint

# Dev
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --durations=10 -n auto --cov=pyspark_feature_jobs tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/python-tatari-logging/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_logging tests/unit

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/tatari-semver-inc/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets
.PHONY: dev
dev:
	poetry install


# Testing related targets
.PHONY: test
test: dev
	poetry run pytest

.PHONY: unit-test
unit-test: dev
	poetry run pytest --junitxml=pytest.xml --cov=tatari_semver_inc tests/unit

.PHONY: integration-test
integration-test: dev
	poetry run pytest tests/integration

.PHONY: type-check
type-check: dev
	poetry run mypy

.PHONY: lint
lint: dev
	poetry run pre-commit run --all-files


# Distribution targets
.PHONY: sdist
sdist:
	poetry build -f sdist

.PHONY: release
release:
	poetry build


# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
--- /home/saidler/slam/tatari-tv/beeswax-win-logs-lambdas/Makefile ---
# Check that given variables are set and all have non-empty values,
# die with an error otherwise.
#
# Params:
#   1. Variable name(s) to test.
#   2. (optional) Error message to print.
check_defined = \
    $(strip $(foreach 1,$1, \
        $(call __check_defined,$1,$(strip $(value 2)))))
__check_defined = \
    $(if $(value $1),, \
      $(error Undefined $1$(if $2, ($2))))

.PHONY: help
help: ## This help dialog.
	@IFS=$$'\n' ; \
	help_lines=(`fgrep -h "##" $(MAKEFILE_LIST) | fgrep -v fgrep | sed -e 's/\\$$//' | sed -e 's/##/:/'`); \
	printf "%-30s %s\n" "target" "details" ; \
	printf "%-30s %s\n" "------" "----" ; \
	for help_line in $${help_lines[@]}; do \
		IFS=$$':' ; \
		help_split=($$help_line) ; \
		help_command=`echo $${help_split[0]} | sed -e 's/^ *//' -e 's/ *$$//'` ; \
		help_info=`echo $${help_split[2]} | sed -e 's/^ *//' -e 's/ *$$//'` ; \
		printf '\033[36m'; \
		printf "%-30s %s" $$help_command ; \
		printf '\033[0m'; \
		printf "%s\n" $$help_info; \
	done

.PHONY: lint
lint: ## Lint Python and Terraform.
	@echo "linting source code..."
	pre-commit run --all-files

.PHONY: unit-test
unit-test: deploy-info ## Run Unit Tests.
	@echo "running unit tests..."
	poetry run python -m pytest tests/unit -s -vvvv

.PHONY: integration-test
integration-test: ## Run Integration Tests.
	@echo "running integration tests..."
	poetry run python -m pytest tests/integration -s -n 8

.PHONY: deploy-info
deploy-info: ## Create deploy.info File.
	@echo "creating deploy.info file..."
	$(shell jq -n --arg author "$(GIT_AUTHOR)" --arg commit "$(GIT_COMMIT_DATETIME)" --arg describe "$(GIT_DESCRIBE)" --arg version "$(GIT_VERSION)" \
		'{"author": $$author, "commit_datetime": $$commit, "git_describe": $$describe, "status": "OK", "version": $$version}' > deploy.info)
--- /home/saidler/slam/tatari-tv/ml-affinity/Makefile ---
.DEFAULT_GOAL := dev

.PHONY: all
all: dev unit-test type-check lint sdist release

# dev targets - separated to avoid DGL removal issues
.PHONY: dev
dev:
	uv sync
	$(MAKE) ensure-dgl

# Ensure DGL is available after uv sync
.PHONY: ensure-dgl
ensure-dgl:
ifeq ($(shell uname), Darwin)
	@if ! uv run python -c "import dgl" &>/dev/null 2>&1; then \
		echo "DGL missing after sync - building from source"; \
		uv run ./scripts/build_dgl.sh; \
	else \
		echo "DGL is available"; \
	fi
endif

# Build DGL only (for manual building)
.PHONY: build-dgl
build-dgl:
ifeq ($(shell uname), Darwin)
	uv run ./scripts/build_dgl.sh
else
	@echo "DGL build only needed on macOS"
endif

# dev targets (only install dev dependencies)
.PHONY: devdev
devdev:
	uv sync --only-group dev

# Testing related targets
.PHONY: unit-test
unit-test: dev
	uv run pytest

.PHONY: type-check
type-check: devdev
	uv run mypy

.PHONY: lint
lint: devdev
	uv run pre-commit run --all-files

# Distribution targets
.PHONY: sdist
sdist:
	@echo "Building source distribution..."
	uv build --sdist

.PHONY: release
release:
	@echo "Building both sdist and wheel..."
	uv build

.PHONY: github-release
github-release:
	uv run ./github-release.sh

# Clean
.PHONY: clean
clean:
	rm -rf build/ dist/ ext/ .venv/ .mypy_cache/ .pytest_cache/
	rm -rf *.egg-info
	rm -rf .coverage*
	find . -name '__pycache__' -delete
	find . -name '*.pyc' -delete
