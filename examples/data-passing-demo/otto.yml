otto:
  name: "Data Passing Mechanism Demo"
  api: 1
  jobs: 2
  about: "Clear demonstration of how otto_set_output and otto_get_input work"

tasks:
  # ============================================================================
  # TASK 1: Producer - Creates data
  # ============================================================================
  task_a:
    help: "First task - produces three values"
    bash: |
      echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
      echo "â•‘  TASK A: PRODUCER                      â•‘"
      echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      echo ""
      echo "ğŸ”§ MECHANISM: Using otto_set_output to create data"
      echo ""

      # Create some simple values
      VALUE_1="hello"
      VALUE_2="42"
      VALUE_3="success"

      echo "Setting outputs:"
      echo "  â€¢ message = \"${VALUE_1}\""
      otto_set_output "message" "${VALUE_1}"

      echo "  â€¢ number = \"${VALUE_2}\""
      otto_set_output "number" "${VALUE_2}"

      echo "  â€¢ status = \"${VALUE_3}\""
      otto_set_output "status" "${VALUE_3}"

      echo ""
      echo "âœ… Task A created 3 outputs"
      echo "ğŸ“ Stored in: output.task_a.json"

  # ============================================================================
  # TASK 2: Consumer - Reads data from Task A
  # ============================================================================
  task_b:
    help: "Second task - consumes data from task_a"
    before: [task_a]
    bash: |
      echo ""
      echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
      echo "â•‘  TASK B: CONSUMER                      â•‘"
      echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      echo ""
      echo "ğŸ”§ MECHANISM: Using otto_get_input to read data"
      echo ""
      echo "Step 1: Must call otto_deserialize_input first"
      echo "  â†’ otto_deserialize_input \"task_a\""

      otto_deserialize_input "task_a"

      echo "  âœ… Input loaded from task_a"
      echo ""
      echo "Step 2: Read values using otto_get_input"
      echo ""

      # Read the values
      received_message=$(otto_get_input "task_a.message")
      received_number=$(otto_get_input "task_a.number")
      received_status=$(otto_get_input "task_a.status")

      # Show what we expected vs what we got
      echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
      echo "â”‚ EXPECTED from task_a:                   â”‚"
      echo "â”‚   message = \"hello\"                     â”‚"
      echo "â”‚   number  = \"42\"                        â”‚"
      echo "â”‚   status  = \"success\"                   â”‚"
      echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
      echo ""
      echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
      echo "â”‚ ACTUALLY RECEIVED:                      â”‚"
      echo "â”‚   message = \"${received_message}\"      â”‚"
      echo "â”‚   number  = \"${received_number}\"       â”‚"
      echo "â”‚   status  = \"${received_status}\"       â”‚"
      echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
      echo ""

      # Validate
      if [ "$received_message" = "hello" ] && \
         [ "$received_number" = "42" ] && \
         [ "$received_status" = "success" ]; then
        echo "âœ… DATA PASSING WORKS! All values match."
      else
        echo "âŒ DATA PASSING FAILED! Values don't match."
      fi

      echo ""
      echo "ğŸ”§ Now we can transform the data:"
      doubled=$((received_number * 2))
      echo "  â€¢ Doubled number: ${received_number} Ã— 2 = ${doubled}"

      # Pass transformed data forward
      otto_set_output "doubled" "${doubled}"
      otto_set_output "original_message" "${received_message}"

      echo ""
      echo "âœ… Task B produced 2 new outputs"

  # ============================================================================
  # TASK 3: Python Consumer - Shows cross-language works
  # ============================================================================
  task_c:
    help: "Third task - Python reads from Bash"
    before: [task_b]
    python: |
      print("")
      print("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—")
      print("â•‘  TASK C: CROSS-LANGUAGE                â•‘")
      print("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
      print("")
      print("ğŸ”§ MECHANISM: Python reading Bash outputs")
      print("")
      print("Step 1: Deserialize input from task_b (bash)")
      print("  â†’ otto_deserialize_input(\"task_b\")")

      otto_deserialize_input("task_b")

      print("  âœ… Input loaded from task_b")
      print("")
      print("Step 2: Read values using otto_get_input")
      print("")

      doubled = otto_get_input("task_b.doubled")
      message = otto_get_input("task_b.original_message")

      print("â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”")
      print("â”‚ EXPECTED from task_b:                   â”‚")
      print("â”‚   doubled = \"84\" (42 * 2)               â”‚")
      print("â”‚   message = \"hello\"                     â”‚")
      print("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜")
      print("")
      print("â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”")
      print(f"â”‚ ACTUALLY RECEIVED:                      â”‚")
      print(f"â”‚   doubled = \"{doubled}\"                 â”‚")
      print(f"â”‚   message = \"{message}\"                 â”‚")
      print("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜")
      print("")

      # Validate
      if doubled == "84" and message == "hello":
        print("âœ… BASHâ†’PYTHON WORKS! Values passed correctly.")
      else:
        print("âŒ BASHâ†’PYTHON FAILED!")

      print("")
      print("ğŸ”§ Python can do math on the string:")
      tripled = int(doubled) + int(doubled) // 2  # 84 + 42 = 126
      print(f"  â€¢ {doubled} + {int(doubled)//2} = {tripled}")

      otto_set_output("tripled", str(tripled))
      print("")
      print("âœ… Task C produced 1 output")

  # ============================================================================
  # TASK 4: Final Report - Shows complete data flow
  # ============================================================================
  report:
    help: "Final task - validates entire pipeline"
    before: [task_c]
    bash: |
      echo ""
      echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
      echo "â•‘  FINAL REPORT: DATA FLOW VALIDATION    â•‘"
      echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      echo ""

      echo "âš ï¸  IMPORTANT LIMITATION:"
      echo "This task only has 'task_c' in its 'before:' list,"
      echo "so it can ONLY access task_c's outputs directly!"
      echo ""

      # Load only our direct dependency
      otto_deserialize_input "task_c"

      echo "ğŸ” What we can access:"
      c_tripled=$(otto_get_input "task_c.tripled")
      echo "  â€¢ task_c.tripled = \"${c_tripled}\""
      echo ""

      echo "ğŸ” FULL PIPELINE TRACE:"
      echo ""
      echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
      echo "â”‚ TASK A (producer):                      â”‚"
      echo "â”‚   Created: number=\"42\"                  â”‚"
      echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
      echo "          â†“ (bash â†’ bash)"
      echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
      echo "â”‚ TASK B (bash consumer):                 â”‚"
      echo "â”‚   Computed: doubled=\"84\" (42 Ã— 2)       â”‚"
      echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
      echo "          â†“ (bash â†’ python)"
      echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
      echo "â”‚ TASK C (python consumer):               â”‚"
      echo "â”‚   Computed: tripled=\"${c_tripled}\" (84 + 42)    â”‚"
      echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
      echo ""
      echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
      echo "â•‘  VALIDATION                            â•‘"
      echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      echo ""

      # Validate what we can
      if [ "$c_tripled" = "126" ]; then
        echo "âœ… PIPELINE WORKS!"
        echo ""
        echo "   Data flow validated:"
        echo "   42 (task_a) â†’ 84 (task_b) â†’ 126 (task_c) âœ“"
        echo ""
        echo "ğŸ‰ Otto's data passing mechanism works correctly!"
      else
        echo "âŒ VALIDATION FAILED!"
        echo "   Expected: 126"
        echo "   Got: ${c_tripled}"
      fi

      echo ""
      echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
      echo "KEY LEARNINGS:"
      echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
      echo "1. Use otto_set_output \"key\" \"value\" to create data"
      echo "2. Use otto_deserialize_input \"task_name\" to load data"
      echo "3. Use otto_get_input \"task_name.key\" to read data"
      echo "4. Works across bash and python!"
      echo "5. Data flows: task_a â†’ task_b â†’ task_c"
      echo ""
      echo "ğŸ“ Inspect files at:"
      echo "   ~/.otto/*/latest/tasks/*/output.*.json"
