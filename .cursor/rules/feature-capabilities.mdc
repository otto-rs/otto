---
description:
globs:
alwaysApply: false
---
# Otto Feature Capabilities Reference

Otto is a production-ready build system with sophisticated features that rival established tools like Make, Ninja, or Bazel.

## Core Features

### Task Management
- **YAML Configuration**: Human-readable task definitions ([examples/ex1/otto.yml](mdc:examples/ex1/otto.yml))
- **Dependency Resolution**: Both `before`/`after` task relationships
- **DAG Execution**: Automatic dependency ordering with cycle detection
- **Parallel Execution**: Configurable concurrency (`-j` flag)
- **Task Classification**: Automatic optimization for IO/CPU/Network-bound tasks

### File Dependencies & Incremental Builds
- **Glob Pattern Support**: `src/**/*.rs`, `*.c`, `include/*.h`
- **Timestamp Checking**: Skip tasks when outputs are newer than inputs
- **Mixed Dependencies**: Tasks can depend on both other tasks and files
- **Automatic Resolution**: Transitive dependency calculation

### Command Line Interface
- **Dynamic Help**: Auto-generated help based on available tasks
- **Task Parameters**: Rich parameter system with validation
- **Multi-Task Execution**: `otto task1 -a val1 task2 -b val2`
- **Global Options**: `-j` (jobs), `-o` (ottofile), `-v` (verbosity), `-T` (timeout)

### Configuration Capabilities

#### Task Definition ([src/cfg/task.rs](mdc:src/cfg/task.rs))
```yaml
tasks:
  build:
    help: "Build the application"
    before: [deps, setup]           # Task dependencies
    after: [test]                   # Reverse dependencies
    input: [src/**/*.rs, Cargo.toml] # File dependencies
    output: [target/debug/app]      # Output files
    envs:                           # Environment variables
      RUST_LOG: debug
    params:                         # CLI parameters
      --release:
        help: "Release build"
        default: false
    action: |                       # Multi-line shell script
      #!/bin/bash
      if [ "${release}" = "true" ]; then
        cargo build --release
      else
        cargo build
      fi
    timeout: 300                    # Task timeout in seconds
```

#### Parameter System ([src/cfg/param.rs](mdc:src/cfg/param.rs))
- **Short/Long Flags**: `-g|--greeting`
- **Type Validation**: Choices, defaults, help text
- **Environment Integration**: Parameters become environment variables
- **Automatic Help**: Generated CLI help for each task

#### Environment Variables ([src/cfg/env.rs](mdc:src/cfg/env.rs))
- **Variable Substitution**: `${VAR:-default}`
- **Shell Commands**: `$(command)`
- **Nested Resolution**: Variables can reference other variables
- **Global/Task Scopes**: Inheritance and override patterns

### Execution Features

#### Workspace Management ([src/executor/workspace.rs](mdc:src/executor/workspace.rs))
- **Project Isolation**: Content-addressable workspaces by project hash
- **Script Caching**: Deduplicated script storage
- **Run History**: Timestamped execution records
- **Artifact Management**: Structured storage for task outputs

#### Output Handling ([src/executor/output.rs](mdc:src/executor/output.rs))
- **Stream Separation**: Distinct stdout/stderr capture
- **Real-time Display**: Live output with task prefixes
- **Structured Data**: JSON outputs for inter-task communication
- **Log Persistence**: All output saved to workspace

### Advanced Features

#### Graph Visualization ([src/executor/graph.rs](mdc:src/executor/graph.rs))
- **Multiple Formats**: SVG, PNG, PDF, DOT, ASCII
- **Dependency Visualization**: Task and file dependency graphs
- **Built-in Command**: `otto graph` for instant visualization

#### Incremental Build Intelligence
- **File Timestamp Analysis**: Precise dependency tracking
- **Glob Expansion**: Complex pattern matching for file sets
- **Selective Execution**: Only run tasks that need updating
- **Dependency Propagation**: Changes cascade through dependency graph

## Usage Examples

### Basic Task Execution
```bash
otto -o examples/ex1 punch              # Run default task
otto -o examples/ex1 hello -g howdy     # Task with parameters
otto -o examples/ex1 hello world        # Multiple tasks
```

### Advanced Features
```bash
otto -o examples/ex1 --help             # Show all available tasks
otto -o examples/ex1 hello --help       # Task-specific help
otto -o examples/ex1 graph              # Visualize dependencies
otto -j 8 -o examples/ex3 example2      # Parallel execution
```

### Configuration Examples
- **[examples/ex1/otto.yml](mdc:examples/ex1/otto.yml)**: Basic tasks with parameters
- **[examples/ex3/otto.yaml](mdc:examples/ex3/otto.yaml)**: File outputs and dependencies

## Production Readiness

### Quality Features
- **Comprehensive Testing**: 72 tests including integration tests
- **Error Handling**: Structured error reporting with context
- **Type Safety**: Strong typing throughout with serde validation
- **Performance**: Async execution with intelligent resource management
- **Reliability**: Timeout handling, graceful failure recovery

### Monitoring & Debugging
- **Verbose Output**: Configurable logging levels
- **Task Status Tracking**: Real-time execution status
- **Workspace Inspection**: All artifacts and logs preserved
- **Dependency Analysis**: Clear dependency resolution output
