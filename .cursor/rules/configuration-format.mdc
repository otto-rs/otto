---
description: 
globs: 
alwaysApply: false
---
# Otto Configuration Format Guide

Otto uses YAML configuration files (typically `otto.yml` or `otto.yaml`) with a sophisticated schema.

## Configuration Structure

### Global Settings ([src/cfg/otto.rs](mdc:src/cfg/otto.rs))
```yaml
otto:
  api: 1                    # Configuration version
  jobs: 16                  # Parallel execution limit
  tasks: [default-task]     # Default tasks to run
  home: ~/.otto            # Workspace directory
  envs:                    # Global environment variables
    VAR: value
```

### Task Definitions ([src/cfg/task.rs](mdc:src/cfg/task.rs))
```yaml
tasks:
  taskname:
    help: "Task description"
    before: [dep1, dep2]     # Dependencies (runs after these)
    after: [dependent1]      # Reverse deps (this runs before these)
    input: [*.c, src/**/*.h] # File dependencies (glob support)
    output: [app, *.o]       # Output files for incremental builds
    envs:                    # Task-specific environment
      CC: gcc
    params:                  # CLI parameters
      -g|--greeting:
        default: hello
        choices: [hello, hi]
        help: Greeting text
    action: |                # Shell script (supports multi-line)
      #!/bin/bash
      echo "${greeting}"
    timeout: 30              # Task timeout in seconds
```

## Key Features

### Parameter System ([src/cfg/param.rs](mdc:src/cfg/param.rs))
- Short and long flags: `-g|--greeting`
- Type validation and choices
- Default values
- Help text generation
- Environment variable integration

### File Dependencies
- Glob pattern support: `src/**/*.rs`, `*.c`
- Timestamp-based incremental builds
- Mixed task and file dependencies
- Automatic dependency resolution

### Environment Variables ([src/cfg/env.rs](mdc:src/cfg/env.rs))
- Variable substitution: `${VAR:-default}`
- Shell command evaluation: `$(command)`
- Nested variable resolution
- Global and task-specific scopes

## Examples
- [examples/ex1/otto.yml](mdc:examples/ex1/otto.yml) - Basic task dependencies and parameters
- [examples/ex3/otto.yaml](mdc:examples/ex3/otto.yaml) - File outputs and complex workflows

